# Pipeline è§¸ç™¼ç­–ç•¥

## ğŸ¯ ç›®æ¨™

å„ªåŒ– CI/CD Pipeline è§¸ç™¼æ¢ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„å»ºç½®åŸ·è¡Œï¼Œæé«˜æ•ˆç‡ä¸¦ç¯€çœè³‡æºã€‚

## ğŸ“‹ è§¸ç™¼æ¢ä»¶é…ç½®

### âœ… **æœƒè§¸ç™¼ Pipeline çš„è®Šæ›´**

#### æ‡‰ç”¨ç¨‹å¼ç¨‹å¼ç¢¼
```
azure-devops/py-flask/
â”œâ”€â”€ app.py                    # Flask æ‡‰ç”¨ä¸»ç¨‹å¼
â”œâ”€â”€ requirements.txt          # Python ä¾è³´
â”œâ”€â”€ Dockerfile               # Docker å»ºç½®é…ç½®
â”œâ”€â”€ templates/               # Flask æ¨¡æ¿
â””â”€â”€ static/                  # éœæ…‹æª”æ¡ˆ (å¦‚æœæœ‰)
```

#### éƒ¨ç½²é…ç½®
```
azure-devops/py-flask/
â”œâ”€â”€ k8s-manifests/           # Kubernetes éƒ¨ç½²æª”æ¡ˆ
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â””â”€â”€ namespace.yaml
â””â”€â”€ azure-pipelines-aks.yml  # Pipeline é…ç½®æœ¬èº«
```

### âŒ **ä¸æœƒè§¸ç™¼ Pipeline çš„è®Šæ›´**

#### æ–‡æª”è®Šæ›´
```
docs/                        # æ‰€æœ‰æ–‡æª”è³‡æ–™å¤¾
â”œâ”€â”€ *.md                     # å„ç¨® Markdown æ–‡æª”
â”œâ”€â”€ README.md               # å°ˆæ¡ˆèªªæ˜
â””â”€â”€ runbooks/               # æ“ä½œæ‰‹å†Š
```

#### åŸºç¤è¨­æ–½ç¨‹å¼ç¢¼
```
terraform/                   # Terraform åŸºç¤è¨­æ–½ (æœ‰ç¨ç«‹ Pipeline)
â”œâ”€â”€ modules/
â”œâ”€â”€ environments/
â””â”€â”€ *.tf
```

#### è‡¨æ™‚æª”æ¡ˆ
```
tmp/                        # è‡¨æ™‚è¨­å®šæª”
software/                   # Self-hosted Agent æª”æ¡ˆ
*.log                       # æ—¥èªŒæª”æ¡ˆ
```

## ğŸ”§ é…ç½®ç¯„ä¾‹

### ç•¶å‰è¨­å®š (å·²å„ªåŒ–)
```yaml
trigger:
  branches:
    include:
    - main
  paths:
    include:
    - azure-devops/py-flask/**
    exclude:
    - docs/**
    - '*.md'
    - terraform/**
    - tmp/**

pr:
  branches:
    include:
    - main
  paths:
    include:
    - azure-devops/py-flask/**
    exclude:
    - docs/**
    - '*.md'
    - terraform/**
    - tmp/**
```

## ğŸ“Š é æœŸæ•ˆæœ

### ğŸš€ **æ•ˆç‡æå‡**
| è®Šæ›´é¡å‹ | ä¹‹å‰ | ä¹‹å¾Œ |
|---------|------|------|
| **æ–‡æª”æ›´æ–°** | âœ… è§¸ç™¼ CI/CD | âŒ ä¸è§¸ç™¼ |
| **Terraform æ›´æ–°** | âœ… è§¸ç™¼ CI/CD | âŒ ä¸è§¸ç™¼ |
| **Flask ç¨‹å¼ç¢¼** | âœ… è§¸ç™¼ CI/CD | âœ… è§¸ç™¼ CI/CD |
| **K8s Manifests** | âœ… è§¸ç™¼ CI/CD | âœ… è§¸ç™¼ CI/CD |

### ğŸ’° **è³‡æºç¯€çœ**
- **Agent ä½¿ç”¨æ™‚é–“**: æ¸›å°‘ ~60-80%
- **ä¸å¿…è¦çš„å»ºç½®**: æ–‡æª”è®Šæ›´ä¸å†è§¸ç™¼
- **é–‹ç™¼æ•ˆç‡**: æ›´å¿«çš„åé¥‹é€±æœŸ

## ğŸ¯ **é€²éšè§¸ç™¼ç­–ç•¥**

### åˆ†æ”¯ç‰¹å®šç­–ç•¥
```yaml
trigger:
  branches:
    include:
    - main
    - develop
    - release/*
  paths:
    include:
    - azure-devops/py-flask/**
```

### å¤šæ‡‰ç”¨ç¨‹å¼æ”¯æ´
å¦‚æœæœªä¾†æœ‰å¤šå€‹æ‡‰ç”¨ç¨‹å¼ï¼š
```yaml
# æ‡‰ç”¨ç¨‹å¼ A
trigger:
  paths:
    include:
    - azure-devops/app-a/**

# æ‡‰ç”¨ç¨‹å¼ B  
trigger:
  paths:
    include:
    - azure-devops/app-b/**
```

### æ¢ä»¶å¼éƒ¨ç½²
```yaml
# åªæœ‰ç‰¹å®šæª”æ¡ˆè®Šæ›´æ‰éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
- stage: DeployProduction
  condition: |
    and(
      eq(variables['Build.SourceBranch'], 'refs/heads/main'),
      or(
        contains(variables['Build.SourceVersionMessage'], '[deploy]'),
        eq(variables['forceProductionDeploy'], 'true')
      )
    )
```

## ğŸ§ª **æ¸¬è©¦å ´æ™¯**

### æ‡‰è©²è§¸ç™¼çš„è®Šæ›´
1. ä¿®æ”¹ `app.py` â†’ âœ… è§¸ç™¼
2. æ›´æ–° `requirements.txt` â†’ âœ… è§¸ç™¼
3. ä¿®æ”¹ `deployment.yaml` â†’ âœ… è§¸ç™¼
4. æ›´æ–° `Dockerfile` â†’ âœ… è§¸ç™¼

### ä¸æ‡‰è©²è§¸ç™¼çš„è®Šæ›´
1. æ›´æ–° `README.md` â†’ âŒ ä¸è§¸ç™¼
2. ä¿®æ”¹ `docs/guide.md` â†’ âŒ ä¸è§¸ç™¼
3. æ›´æ”¹ Terraform æª”æ¡ˆ â†’ âŒ ä¸è§¸ç™¼
4. æ·»åŠ  `tmp/` ä¸‹çš„æª”æ¡ˆ â†’ âŒ ä¸è§¸ç™¼

## ğŸ“ **æœ€ä½³å¯¦è¸**

1. **æ˜ç¢ºçš„è·¯å¾„éæ¿¾**: ä½¿ç”¨å…·é«”çš„è·¯å¾„è€Œéæ³›ç”¨è¦å‰‡
2. **æ¸¬è©¦è§¸ç™¼æ¢ä»¶**: å®šæœŸé©—è­‰è§¸ç™¼é‚è¼¯æ˜¯å¦æ­£ç¢º
3. **æ–‡æª”åŒæ­¥**: ç¢ºä¿è§¸ç™¼ç­–ç•¥æ–‡æª”èˆ‡å¯¦éš›é…ç½®ä¸€è‡´
4. **ç›£æ§è§¸ç™¼é »ç‡**: è¿½è¹¤è§¸ç™¼æ¬¡æ•¸çš„è®ŠåŒ–
5. **éˆæ´»èª¿æ•´**: æ ¹æ“šåœ˜éšŠå·¥ä½œæµç¨‹èª¿æ•´ç­–ç•¥

## ğŸš¨ **æ³¨æ„äº‹é …**

1. **Pipeline é…ç½®è®Šæ›´**: ä¿®æ”¹ `azure-pipelines-aks.yml` æœ¬èº«æœƒè§¸ç™¼ Pipeline
2. **è¬ç”¨å­—ç¬¦èªæ³•**: ä½¿ç”¨æ­£ç¢ºçš„ glob æ¨¡å¼
3. **å¤§å°å¯«æ•æ„Ÿ**: è·¯å¾„åŒ¹é…å€åˆ†å¤§å°å¯«
4. **æ–œç·šæ–¹å‘**: ä½¿ç”¨ `/` è€Œé `\`
5. **æ¸¬è©¦å……åˆ†**: ç¢ºä¿é‡è¦è®Šæ›´ä¸æœƒè¢«éæ¿¾æ‰

---

**å»ºç«‹æ—¥æœŸ**: 2025-08-11  
**æœ€å¾Œæ›´æ–°**: 2025-08-11  
**ç¶­è­·è€…**: DevOps Team